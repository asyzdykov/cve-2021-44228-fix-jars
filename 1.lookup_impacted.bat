@echo off

SET ZIP_PATH=C:\PROGRA~1\7-Zip\7z.exe
set RESULT_FILE_NAME=log4j_impacted_jars_details
set APPLY_FIX=FALSE
set CURR_DIR=%cd%

TITLE Find and Fix the Log4j Issue

IF NOT EXIST %ZIP_PATH% (
@echo ------------------------------------------------------------------------------------
@echo 7Zip is not installed : %ZIP_PATH%, So using UnZip
@echo ------------------------------------------------------------------------------------
pause
exit 1
)

REM ------------------------------------------------------------------------------------
REM Block for applying timestamp for the log
REM ------------------------------------------------------------------------------------
set MYDATE=%date:/=% && set mytime=%time::=%
set MYTIME=%mytime:,=%

set RESULT_FILE_NAME=%RESULT_FILE_NAME%.txt
set RESULT_FILE=%CURR_DIR%\%RESULT_FILE_NAME%

@echo RESULT_FILE : %RESULT_FILE%

IF NOT DEFINED TEMP set RESULT_FILE=C:\Temp\%RESULT_FILE_NAME%
IF NOT EXIST "C:\Temp\." set RESULT_FILE=C:\Windows\Temp\%RESULT_FILE_NAME%

@echo ------------------------------------------------------------------------------------
@echo Deleting the Result file if exist : %RESULT_FILE%
@echo ------------------------------------------------------------------------------------
IF EXIST "%RESULT_FILE%" DEL /Q /F "%RESULT_FILE%"
IF EXIST "%RESULT_FILE%.error" DEL /Q /F "%RESULT_FILE%.error"
@echo.

@echo ------------------------------------------------------------------------------------
@echo Writing the name of impacted jars to file %RESULT_FILE%

FORFILES /S /M *.jar /C "cmd /c %ZIP_PATH% l @file | FINDSTR /i /C:"\JndiLookup.class" && echo @path >> %RESULT_FILE%"

@echo.
@echo ------------------------------------------------------------------------------------
@echo Please check the file %RESULT_FILE% for the impacted data
@echo Please check the file %RESULT_FILE%.error for unprocessed data
@echo ------------------------------------------------------------------------------------

pause
